divisor(N, X-Y) :- between(1, N, X), N mod X =:= 0, Y is N // X, X =< Y.

pair(G, X-Y, G2) :- select(N, G, G1), divisor(N, X-Y), S is X + Y, select(S, G1, G2).

score([], 0).
score([X-Y|Xs], N) :- score(Xs, N0), N is N0 + Y - X.

check_pairs(L, S) :- pairs_keys(L, S0), pairs_values(L, S1), append(S0, S1, S2), msort(S2, S).

solution(T, N) :- solution(T, [], N), !.
solution(tetonor([],S), L, N) :- check_pairs(L, S), score(L, N).
solution(tetonor(G,S), L, N) :- pair(G, P, G1), solution(tetonor(G1,S), [P|L], N).

% < 1 min
answer(X) :- input(L), maplist(solution, L, Ns), sum_list(Ns, X).

input([tetonor([55,285,27,323,22,400,20,49,40,336,50,98,36,12,96,294],
               [_,2,3,_,_,7,_,_,17,19,20,_,_,42,48,_]),
       tetonor([70,52,196,17,53,234,35,114,150,29,276,41,31,264,50,78],
               [3,3,_,6,6,7,_,_,_,_,26,_,38,44,_,_]),
       tetonor([35,150,41,77,297,17,133,38,52,352,26,360,66,42,264,18],
               [_,_,_,_,7,8,_,11,_,_,_,_,30,_,33,_]),
       tetonor([116,18,56,24,10,90,20,60,33,16,100,19,23,25,17,70],
               [1,_,2,3,4,_,_,_,_,_,14,_,_,_,_,_]),
       tetonor([60,23,13,6,12,112,17,48,22,18,105,30,26,7,19,9],
               [_,_,2,3,3,3,_,6,_,8,12,14,_,16,_,21]),
       tetonor([25,13,72,30,69,29,100,24,11,9,26,22,15,36,10,54],
               [1,2,3,3,3,_,_,_,_,9,10,12,18,20,_,_]),
       tetonor([132,120,23,27,180,27,130,29,198,28,31,126,168,92,23,26],
               [_,_,6,_,9,9,10,_,_,_,_,_,_,_,22,_]),
       tetonor([10,12,25,99,45,20,16,28,64,20,15,14,8,36,11,16],
               [_,2,_,3,5,5,5,5,_,8,9,_,11,11,14,18]),
       tetonor([12,13,26,17,40,42,18,30,35,13,45,70,30,17,14,15],
               [_,2,3,_,4,5,6,_,7,7,_,10,10,13,_,15]),
       tetonor([27,198,126,37,102,29,132,25,180,144,28,23,210,37,160,41],
               [_,5,6,6,6,_,9,11,16,_,18,_,_,_,_,_]),
       tetonor([144,30,24,180,21,176,26,140,28,27,160,98,33,182,27,200],
               [_,7,8,8,10,_,_,12,_,14,14,_,18,_,_,_])]).
